<form method="post">
    {% csrf_token %}
    {{ form.as_p }}
    <button type="submit">Login</button>
</form>

<!-- Попап для верификации SMS кода -->
<div id="verifyPopup" style="display: none;">
    <form method="post" action="{% url 'verify_login' %}">
        {% csrf_token %}
        {{ verification_form.as_p }}
        <button type="submit">Verify</button>
    </form>
</div>

<script>
    document.querySelector('form').addEventListener('submit', function(event) {
        event.preventDefault();
        fetch("{% url 'login' %}", {
            method: "POST",
            headers: {
                "Content-Type": "application/x-www-form-urlencoded",
                "X-CSRFToken": document.querySelector('[name=csrfmiddlewaretoken]').value
            },
            body: new URLSearchParams(new FormData(event.target)).toString()
        }).then(response => {
            if (response.ok) {
                document.getElementById('verifyPopup').style.display = 'block';
            } else {
                // Обработка ошибок
            }
        });
    });
</script>
